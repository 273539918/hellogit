## 总结

1、单个请求 -> 需要消耗大量的CPU计算能力
2、Google要支持每秒上千个请求 ->需要有超级计算机的能力 -> 成本过高 -> 通过大量低成本PC+软件容错提供相同的能力
3、Google提供软件级的可用性而不是服务器级的可用性
4、 服务器超过3年就会比新机器慢很多+软件上要均衡不同机型的配置和负载的成本会变高 -> 服务器一般3～4年就会过保替换  -> 折旧期较短 -> 设备成本占总体成本的主要地位   
5、相同成本下，数量大但廉价的PC比少量但高性能服务所提供的CPU数量、磁盘、内存等都要多。
6、数量巨大的PC会带来大量的系统管理和维修成本 ？ -> 对于相对同质的应用该程序，在计算机上安装升级维护工具，则维护1000台和维护100台成本并没有太多变化
7、能耗问题 ->商业数据中心的典型功率密度 远低于PC集群所需要的功率 -> 需要特殊的冷却或更大的空间，以将功率密度降低到典型数据中心所能承受的水平
8、集群解决方案  -> 更低的成本满足服务的性能和可用性要求 -> 适合的应用 1、着重性价比 2、可以在没有私有状态的服务器上运行（因此可以复制服务器）-> 比如计算量大单本质无状态的Web服务器 

## 谷歌集群架构

很少有Web服务像搜索引擎那样需要对每个请求进行大量的计算。平均一个请求需要读取数百兆字节数据，并消耗数百亿个CPU周期。要支持每秒数千个查询的高峰请求流，就需要一个与大型超级计算机安装规模相当的基础架构。将超过15,000台商用级PC与容错软件相结合，所创建的解决方案比采用少量高端服务器构建的同类系统更具成本效益

在这里，我们介绍了Google集群的体系结构，并讨论了影响其设计的最重要因素：能源效率和性价比。

我们的应用程序提供了简单的并行化：不同的查询可以在不同的处理器上运行，并且总索引已分区，因此单个查询可以使用多个处理器。因此，处理器的性价比会比峰值处理性能更重要。

## Google架构概述

Google的软件架构来自两个基础。首先，Google提供软件级而不是服务器级硬件的可靠性，因此可以使用商用PC以低端价格构建高端计算集群。其次，由于可以通过并行处理单个请求来应对服务器响应时间，我们针对最佳聚合请求吞吐量而不是峰值服务器响应时间进行设计

我们认为，从不可靠的商用PC集群中构建可靠的计算基础架构能够为应用程序提供最佳的性价比。通过在许多不同的机器上复制服务并自动检测和处理故障，我们在软件级别的环境中提供了可靠性。这种基于软件的可靠性涵盖许多不同领域，涉及我们系统设计的所有部分

### Google查询服务

当用户向Google输入查询（例如www.google.com/search?q=ieee+society）时，用户的浏览器会首先执行域名系统（DNS）查找，以将www.google.com映射到特定的IP地址。为了提供足够的容量来处理查询流量，我们的服务由遍布全球的多个集群组成。每个集群大约有数千台计算机，而且地理分布的设置可以保护我们免受灾难性的数据中心故障（例如由于地震和大规模电源故障引起的故障）的影响。基于DNS的负载平衡系统通过考虑用户与每个物理群集的地理位置相近来选择群集。负载平衡系统可最大程度地缩短用户请求的往返时间，同时还考虑了各个群集的可用容量。



## 利用商品零件

实际上，由于与新机器相比性能方面的差异，服务器的使用寿命不会超过两到三年。三年以上的计算机比当前的计算机要慢得多，因此很难在包含这两种类型的集群中实现正确的负载分配和配置。由于折旧期相对较短，因此设备成本在总体成本中占主要地位。

对于像我们这样的高度可并行化的应用程序而言，使用廉价的基于PC的群集的成本优势可能非常可观。$ 278,000的示例机架包含176个2 GHz Xeon CPU，176 Gb RAM和7 TB磁盘空间。相比之下，典型的基于x86的服务器包含八个2-GHz Xeon CPU，64 GB的RAM和8 TB的磁盘空间。 它的成本约为758,000美元。换句话说，多处理器服务器的价格高出三倍左右，但CPU数量减少了22倍，RAM减少了三倍，磁盘空间也略多。

操作数千台中型PC而不是几台高端多处理器服务器会导致大量的系统管理和维修成本。但是，对于像Google这样相对同质的应用程序，其中大多数服务器都运行极少数应用程序之一，因此这些成本是可以控制的。假设可以使用在计算机组上安装和升级软件的工具，则维护1000台服务器的时间和成本不会比维护100台服务器的成本高很多，因为所有计算机都具有相同的配置。同样，使用可伸缩应用程序监视系统监视群集的成本不会随群集大小的增加而大大增加。此外，我们可以通过分批进行维修，并确保可以轻松更换掉故障率最高的组件（例如磁盘和电源），从而将维修成本保持在合理的较低水平。



## 电源问题

功耗和散热问题是一个有挑战性的问题。具有双1.4 GHz Pentium III处理器的中档服务器在负载下可吸收约90 W的直流功率：两个CPU约55 W，磁盘驱动器约10 W，而DRAM和主板则为25W。ATX电源的典型效率约为75％，这意味着每台服务器的交流电源功率为120瓦，或者每个机架约为10千瓦。机架比较适合25平方英尺的空间，因此功率密度为400 W / ft2。使用高端处理器，机架的功率密度可以超过700 W / ft2。不幸的是，商业数据中心的典型功率密度在70至150 W / ft2之间，远低于PC群集所需的功率密度。因此，即使使用相对简单的包装的低技术PC集群也需要特殊的冷却或额外的空间，以将功率密度降低到典型数据中心所能承受的水平。

功率降低的服务器对于大型集群很有吸引力，但是您必须牢记一些注意事项。首先，降低功率是可取的，但是对于我们的应用程序来说，必须降低功率，而不会相应降低性能：计算的是单位性能的瓦数，而不是单独的瓦数。其次，第二,低功耗服务器不能更昂贵，因为折旧的费用通常超过电源成本。前面提到的10 kW机架每月消耗大约10 MW-h的功率（包括冷却开销）。即使以每千瓦时15美分的高价（一半为实际功率，一半为分摊不间断电源[UPS]和配电设备），每月的电力和冷却成本也仅为1,500美元。与每月7,700美元的折旧费用相比，这样的费用很小。 因此，低功耗服务器不得比常规服务器贵，这样才能在我们的设置中具有总体成本优势。

## 硬件级应用程序特征

检查应用程序的各种体系结构特征有助于说明哪些硬件将为我们的查询服务系统提供最佳的性价比。

如前所述，我们的基础架构由大量廉价的台式机组成，而不是少数的大型共享内存机。

在Google，对索引数据和计算进行分区以最大程度地减少通信并平衡服务器之间的负载。而且，大型共享内存计算机仍无法正常处理单个硬件组件或软件故障，大多数故障类型会导致整个系统崩溃。通过部署许多小型多处理器，我们将故障的影响控制在较小的系统中。总体而言，集群解决方案可以以更低的成本满足我们服务的性能和可用性要求。

许多应用程序都具有允许基于PC的群集体系结构的基本特征。只要面向应用程序着眼于性价比，并且可以在没有私有状态的服务器上运行（因此可以复制服务器），那么使用类似的体系结构可能会受益。常见的示例包括计算量大但本质上是无状态的大容量Web服务器或应用程序服务器。所有这些应用程序都具有大量的请求级并行性，这一特征可以通过在单独的服务器上运行单个请求来利用。实际上，大型网站已经普遍使用这种架构。

在Google的规模上，大规模服务器并行性的某些局限性确实显而易见，例如商业数据中心的有限冷却能力以及面向吞吐量应用的当前CPU的适应性不足。不过，使用便宜的PC来处理Google的大规模计算已大大增加了我们可以为每次查询支付的计算量，从而帮助改善了数千万用户的Internet搜索体验。





